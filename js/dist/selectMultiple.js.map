{"version":3,"sources":["../src/selectMultiple.js"],"names":["SelectMultiple","element","btn","querySelector","toggle","collapses","querySelectorAll","data","input","selectedOptions","_getSelectedOptions","placeholder","groups","_addEventListeners","forEach","group","groupId","dataset","id","values","label","currentValues","valuesNode","max","length","addEventListener","_handleChangeGroupState","value","push","target","_handleDefaultOptionState","_handleChangeOptionState","_updatePlaceholder","_handleGroupState","event","console","log","stopPropagation","_handleChangePlaceholder","classList","item","$","collapse","document","remove","options","opts","i","selected","valueId","isSelected","findIndex","o","_toggleValue","includes","add","pull","counter","_removeValues","_addValues","totalCurrentValues","totalValues","key"],"mappings":"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","file":"selectMultiple.js","sourcesContent":["import $ from 'jquery'\nimport findIndex from '../../node_modules/lodash-es/findIndex'\nimport includes from '../../node_modules/lodash-es/includes'\nimport pull from '../../node_modules/lodash-es/pull'\n\n/**\n * ------------------------------------------------------------------------\n * Class Definition\n * ------------------------------------------------------------------------\n */\n\nclass SelectMultiple {\n  constructor(element) {\n    this.element = element\n    this.btn = element.querySelector('[data-role=btn]')\n    this.toggle = element.querySelector('[data-role=select-toggle')\n    this.collapses = element.querySelectorAll('[data-role=collapse')\n    this.data = {}\n    this.input = element.querySelector('[data-role=input]')\n    this.selectedOptions = this._getSelectedOptions(this.input)\n    this.placeholder = element.querySelector('[data-role=placeholder]')\n    const groups = element.querySelectorAll('[data-role=group]')\n\n    this._addEventListeners()\n\n    groups.forEach((group) => {\n      const groupId = group.dataset.id;\n      const values = group.querySelectorAll('[data-role=value]')\n\n      this.data[groupId] = {\n        label: group.querySelector('[data-role=counter]'),\n        currentValues: [],\n        values: [],\n        valuesNode: values,\n        max: values.length\n      }\n\n      this.data[groupId].label.addEventListener('click', () => {\n        this._handleChangeGroupState(groupId)\n      })\n\n      values.forEach((value) => {\n        this.data[groupId].values.push(value.dataset.target)\n        this._handleDefaultOptionState(value, groupId)\n\n        value.addEventListener('click', () => {\n          this._handleChangeOptionState(value, groupId)\n        })\n      })\n\n      this._updatePlaceholder()\n      this._handleGroupState(groupId)\n    })\n\n    this.placeholder.addEventListener('click', (event) => {\n      console.log('click')\n      event.stopPropagation()\n      this._handleChangePlaceholder()\n    })\n  }\n\n  // Private\n\n  _addEventListeners() {\n    this.toggle.addEventListener('click', (event) => {\n      event.stopPropagation()\n      this.element.classList.toggle('active')\n      this.btn.classList.toggle('active')\n    })\n\n    this.collapses.forEach((item) => {\n      item.addEventListener('click', (event) => {\n        event.target.classList.toggle('active')\n        // bootstrap jQuery collapse\n        $(event.target.dataset.target).collapse('toggle')\n      })\n    })\n\n    this.element.addEventListener('click', (event) => {\n      event.stopPropagation()\n    })\n\n    document.addEventListener('click', () => {\n      this.element.classList.remove('active')\n      this.btn.classList.remove('active')\n    })\n  }\n\n  _getSelectedOptions(element) {\n    // validate element\n    if (!element || !element.options) {\n      // or null?\n      return []\n    }\n\n    // return HTML5 implementation of selectedOptions instead.\n    if (element.selectedOptions) {\n      return element.selectedOptions\n    }\n\n    // you are here because your browser doesn't have the HTML5 selectedOptions\n    const opts = element.options\n    const selectedOptions = []\n\n    for (let i = 0; i < opts.length; i++) {\n      if (opts[i].selected) {\n        selectedOptions.push(opts[i])\n      }\n    }\n\n    return selectedOptions\n  }\n\n  _handleDefaultOptionState(value, groupId = 0) {\n    const valueId = value.dataset.target;\n    const isSelected = findIndex(this.selectedOptions, (o) => { return o.dataset.id === valueId })\n    this._toggleValue(value, groupId, isSelected >= 0 ? false : true)\n  }\n\n  _handleChangeOptionState(value, groupId = 0) {\n    const valueId = value.dataset.target;\n    const isSelected = includes(this.data[groupId].currentValues, valueId);\n\n    this._toggleValue(value, groupId, isSelected)\n  }\n\n  _toggleValue(value, groupId, isSelected) {\n    const valueId = value.dataset.target;\n\n    if (!isSelected) {\n      this.data[groupId].currentValues.push(valueId)\n      value.classList.add('active')\n    } else {\n      pull(this.data[groupId].currentValues, valueId)\n      value.classList.remove('active')\n    }\n\n    this._updatePlaceholder()\n    this._handleGroupState(groupId)\n  }\n\n  _handleGroupState(groupId = 0) {\n    const counter = this.data[groupId].label\n    const length = this.data[groupId].currentValues.length\n\n    if (length > 0) {\n      if (length === this.data[groupId].max) {\n        counter.classList.add('active')\n        counter.classList.remove('indeterminate')\n      } else {\n        counter.classList.remove('active')\n        counter.classList.add('indeterminate')\n      }\n    } else {\n      counter.classList.remove('active')\n      counter.classList.remove('indeterminate')\n    }\n  }\n\n  _handleChangeGroupState(groupId) {\n    if (this.data[groupId].currentValues.length === this.data[groupId].values.length) {\n      this.data[groupId].label.classList.remove('active')\n      this.data[groupId].label.classList.remove('indeterminate')\n      this._removeValues(groupId)\n    } else {\n      this.data[groupId].label.classList.add('active')\n      this.data[groupId].label.classList.remove('indeterminate')\n      this._addValues(groupId)\n    }\n\n    this._updatePlaceholder()\n  }\n\n  _addValues(groupId) {\n    this.data[groupId].currentValues = this.data[groupId].values\n    this.data[groupId].valuesNode.forEach((value) => {\n      value.classList.add('active')\n      value.classList.remove('indeterminate')\n      this.input[value.dataset.target].selected = true\n    })\n  }\n\n  _removeValues(groupId) {\n    this.data[groupId].currentValues = []\n    this.data[groupId].valuesNode.forEach((value) => {\n      value.classList.remove('active')\n      value.classList.remove('indeterminate')\n      this.input[value.dataset.target].selected = false\n    })\n  }\n\n  _handleChangePlaceholder() {\n    let totalCurrentValues = null\n    let totalValues = null\n\n    for (const key in this.data) {\n      totalCurrentValues += this.data[key].currentValues.length\n      totalValues += this.data[key].values.length\n    }\n\n    console.log('totalCurrentValues: ', totalCurrentValues)\n    console.log('totalValues: ', totalValues)\n\n    if (totalCurrentValues > 0) {\n      for (const key in this.data) {\n        this.data[key].currentValues = []\n        this._handleGroupState(key)\n        this._removeValues(key)\n      }\n    } else {\n      for (const key in this.data) {\n        this.data[key].currentValues = this.data[key].values\n        this._handleGroupState(key)\n        this._addValues(key)\n      }\n    }\n\n    this._updatePlaceholder()\n  }\n\n  _updatePlaceholder() {\n    let totalCurrentValues = null\n    let totalValues = null\n\n    for (const key in this.data) {\n      totalCurrentValues += this.data[key].currentValues.length\n      totalValues += this.data[key].values.length\n    }\n\n    if (totalCurrentValues > 0) {\n      if (totalValues === totalCurrentValues) {\n        this.placeholder.classList.add('active')\n        this.placeholder.classList.remove('indeterminate')\n      } else {\n        this.placeholder.classList.remove('active')\n        this.placeholder.classList.add('indeterminate')\n      }\n    } else {\n      this.placeholder.classList.remove('active')\n      this.placeholder.classList.remove('indeterminate')\n    }\n  }\n}\n\nexport default SelectMultiple\n"]}